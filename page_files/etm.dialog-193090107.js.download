/*
 * Copyright (c) Infor 2016. All rights reserved. www.infor.com
 */

function showAlert(titleText, messageToDisplay, buttonLabel){
    var buttons = {};
    var title =  '<span class="alertTitleIcon"></span> <span class="alertPopupTitle">' + titleText + '</span>';

    buttons [buttonLabel] = { text: buttonLabel, 
                              click: function(){$(this).dialog("close");
                                                $("body").find("#alertBox").remove();}
                            };

    // add a div to the DOM that will store our alert message
    if ($('#alertBox').length == 0){
       $("<div id='alertBox'></div>").appendTo("body");         
    }

    $("#alertBox").text(messageToDisplay);
    $("#alertBox").dialog({ modal: true,
                            resizable: false,
                            draggable: false,
                            buttons: buttons,
                            title: '', 
                            open: getOnOpen(title),
                            close:function(event,ui) {$("body").find("#alertBox").remove();},
                            classes:{
                                "ui-dialog": "etm-ui-dialog"
                            }
                         });
}

function showAlertAndAction(titleText, messageToDisplay, buttonLabel, buttonAction){
    var buttons = {};

    var title =  '<span class="alertTitleIcon"></span> <span class="alertPopupTitle">' + titleText + '</span>';

    buttons [buttonLabel] = { text: buttonLabel, 
                              click: function(){$(this).dialog("close");
                                                $("body").find("#alertBox").remove();
                                                buttonAction();}
                            };

    // add a div to the DOM that will store our alert message
    if ($('#alertBox').length == 0){
       $("<div id='alertBox'></div>").appendTo("body");         
    }

    $("#alertBox").text(messageToDisplay);
    $("#alertBox").dialog({ modal: true,
                            resizable: false,
                            draggable: false,
                            buttons: buttons,
                            title: '', 
                            open: getOnOpen(title),
                            close:function(event,ui) {$("body").find("#alertBox").remove();},
                            classes:{
                                "ui-dialog": "etm-ui-dialog"
                            }
                         });
}

var dialogResult = false;

function confirmDialogYesNo(titleText, okLabel, cancelLabel, messageToDisplay, okFunction, cancelFunction){
   
   var title =  '<span class="confirmTitleIcon"></span> <span class="confirmPopupTitle">' + titleText + '</span>';
   var buttons = {};
   var returnBool = false;
   
   if (!dialogResult){

       buttons [okLabel] = { text: okLabel,
                             click: function () {
                                      dialogResult = true;
                                      $(this).dialog("close");
                                      if (typeof okFunction == 'function'){
                                         okFunction();
                                      };
                                   }
                           };

       buttons [cancelLabel] = { text: cancelLabel,
                                 click: function () {
                                           dialogResult = false;
                                           $(this).dialog("close");
                                           if (typeof cancelFunction == 'function'){
                                              cancelFunction();
                                           } else {
                                              return false;
                                           };
                                        }
                                };

       // add a div to the DOM that will store our message
       if ($('#confirmDialogBox').length == 0){
           $("<div id='confirmDialogBox'></div>").appendTo("body");
       }

       $("#confirmDialogBox").text(messageToDisplay);
       $("#confirmDialogBox").dialog({ modal: true,
                                       resizable: false,
                                       draggable: false,
                                       buttons: buttons,
                                       title: '',
                                       open: getOnOpen(title),
                                       close:function(event,ui) {
                                             $("body").find("#confirmDialogBox").remove();
                                             dialogResult = false;
                                         },
                                       classes:{
                                           "ui-dialog": "etm-ui-dialog"
                                       }
                                       });
   } else {
       returnBool = true;
       dialogResult = false;
   }

   return returnBool;
}

function getOnOpen(title) {

	return function(event, ui) {
        // Adjust to ensure scroll bar doesn't appear

  	   var overlay = $('.ui-widget-overlay');
  	   overlay.css({
  		   	'width'    : '100%',
  		   	'height'   : '100%' ,
  		   	'overflow' : 'hidden',
  		   	'z-index'  : '9998'

  	   });

	   var root = $(this).closest(".ui-dialog");
	   root.find(".ui-dialog-title").append(title);
	};
}

function confirmDialog(titleText, okLabel, cancelLabel, messageToDisplay, okFunction){

    var returnBool = confirmDialogYesNo(titleText, okLabel, cancelLabel, messageToDisplay, okFunction, "");

    return returnBool;
}

function closePopup(){
   // Required to prevent JavaScript errors in IE9
   // when the iframe is detached from the DOM
   $("#dialogBox").html("");
   $("#dialogBox").remove();
}

function hidePopup(){
   $("#dialogBox").hide();
}

function openPopup(popupUrl){

    var inline = $("#inlinePopupPage");

    // Add a div to the DOM that to be used as the container
    // for our JQuery dialog box
    if ($('#dialogBox').length == 0){
        $("<div id='dialogBox'></div>").appendTo("body");
    }

    var frameHeight = 0;
    var frameWidth = 0;

    // Create an iframe using the passed in URL
    // then load this into a DIV ready for use within
    // a JQuery modal dialog box
    if (inline.length == 0) {

       var loader = $("<div id=\"popupLoader\" class=\"ajaxLoader\"></div>");
       $("#dialogBox").html(loader);

       var frame = $("<iframe/>", {
          id : 'inlinePopupPage',
          name : 'inlinePopupPage',
          scrolling : "no",
          frameborder : "no",
          style : "margin: 0px; padding: 0px; border: 0px; border-radius: 6px;"
       });

       frame.appendTo($('#dialogBox')).attr("src", popupUrl).load(function(){
          // Remove loader spinner
          loader.remove();
          // reset the height of the frame to ensure
          // it expands to fit the content
          var frame = $("#inlinePopupPage");

          frameHeight = frame[0].contentWindow.getHeight();
          frame.css("height", "" + frameHeight + "px");
          frameWidth = frame[0].contentWindow.getWidth();
          frame.css("width", "" + frameWidth + "px");
          // re-centre dialog box after all content has been
          // been loaded into the iframe
          $("#dialogBox").dialog('option','position','center');

       });

       // Open a modal dialog box using the slide effects
       // to open and close
       $("#dialogBox").dialog({ modal: true,
                                resizable: false,
                                draggable: false,
                                autoOpen: true,
                                width: 'auto',
                                height: 'auto',
                                show: {effect: 'slide', duration: 'fast'},
                                hide: {effect: 'slide', duration: 'fast'},
                                open: function(event,ui) {
                                    getOnOpen('').call(this, event, ui);

                                    $('.ui-widget-overlay').click(closePopup); // Close dialog box on click on overlay
                                    $(".ui-dialog-titlebar").hide(); // Hide title bar
                                    $(".ui-dialog-content").css("padding", "0px").css("margin", "0px"); // remove default padding
                                    $(this).parent().promise().done(function() {
                                        frame.addClass("fully-loaded-iframe");
                                    });
                                },
                                close: function(event,ui){
                                     closePopup();
                                },
                               classes:{
                                   "ui-dialog": "etm-ui-dialog"
                               }
                               });
    } else {
       if (inline.is(":visible")){
          inline.fadeIn("fast");
       } else {
          inline.fadeOut("fast");
       }
    }
}